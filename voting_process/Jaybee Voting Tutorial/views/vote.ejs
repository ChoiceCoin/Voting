<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Voting Using Choice</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Raleway:wght@200;500&family=Roboto:ital,wght@1,300&family=Rubik:ital,wght@0,300;1,300;1,500&display=swap" rel="stylesheet">
    <body style="background-image: linear-gradient(white,#5F6ADA); overflow-y: scroll; ">
    <section style="height: max-content;">
      <nav style="position: absolute; top: 0px; width: 100%; background-color: #533AFE;" class="nav">
        <a style="color: white; font-size: 20px; margin-left: 200px; font-weight: 500; font-family: 'Raleway', sans-serif; " class="nav-link" aria-current="page" href="#"> <img style="height: 30px; align-self: center;" src="/img/choice2.png"alt=""> Choice</a>
        <a id="home-link" style="color: white; margin-left: 30%; font-family: 'Raleway', sans-serif; " class="nav-link" href="/">Home</a>
        <a style="color: white; font-family: 'Raleway', sans-serif; margin-right: 20px;" class="nav-link" href="#">About</a>
        <button id="connect_algosigner"   style="  font-family: 'Raleway', sans-serif; float: right; color: white; font-weight: 500;  margin-right: 20px; background-color: #3ECF8E;;" class="nav-link btn btn-primary">Connect Via Algosigner</button>
        <button id="connect_algowallet"   style="  font-family: 'Raleway', sans-serif; float: right; color: white; font-weight: 500;  margin-right: 20px; background-color: #3ECF8E;;" class="nav-link btn btn-primary">Connect Via AlgoWallet</button>
        <a>
          <div id="wallet" style="font-family: 'Rubik',sans-serif;  float: right; display: none;">
            <label style=" font-size: 12px; margin-bottom: 1px; font-weight: 600;" for="inputState" class="form-label"> Wallet Address:</label>
            <select style="height: 30px; width: 630px; background-color: #533AFE; border: #533AFE; font-weight: 400px;"  name="voted_for" required id="inputState" class="form-select">
            </select>
          </div>
        </a>
        <small id="balance" style="font-size: 12px; display: none;  font-weight: 500; margin-top: 18px;">Algo Balance: <span id="algo_balance"></span>    Choice Balance: <span id="choice_balance"></span></small>
      </nav>

      <div id="total_choice_sent" style="margin-top: 70px; display: none;  font-weight: 400; font-family: Georgia, 'Times New Roman', Times, serif;" class="alert alert-success" role="alert">
        You have successfully sent 50 choice over the last 20 transactions
      </div>

        <div style="width: 90%; margin-top: 100px; margin-bottom: 70px;  padding-right: 0;background-repeat: no-repeat;  ;" class="container">
            <div class="election">
                <h3 style="font-family: 'Rubik', sans-serif; margin-left: 5%; font-weight: 500; display: inline-block;">VOTING USING CHOICE COIN</h3>
                <button id="disconnect"   style="  font-family: 'Raleway', sans-serif; display: none; float: right; color: white; font-weight: 500;  margin-right: 20px; background-color: #3ECF8E;;" class="nav-link btn btn-primary">Disconnect</button>
                <div class="issue">
                  <h3 style="font-family: 'Rubik', sans-serif; margin-top: 50px; font-weight: 600; letter-spacing: 1.2px  ; margin-left: 10%; display: inline-block;">ISSUE 002 (Capitalism)</h3>
                  <p style="font-size: 18px; padding: 0; margin-top: 10px;  margin-left: 70px; letter-spacing: 1.75px;  font-weight: 400; font-family: Georgia, 'Times New Roman', Times, serif;">Capitalism is an economic and political system in which a country's trade and industry are controlled by private owners for profit, rather than by the state. While capitalism does lead to innovation and improved efficiency while providing consumers with choice, the world still seems divided on whether this economic system is suitable for optimum living conditions as it breeds competition, ignores people's needs, and creates inequality.</p>
                  <p style="font-size: 18px; padding: 0; margin-top: -6.5px;   margin-left: 70px; letter-spacing: 1.75px;  font-weight: 400; font-family: Georgia, 'Times New Roman', Times, serif;">We would love to acknolewdge your view on this subject.Do you think the capitalsim is the right economic approach?</p>
                </div>
                <p style="font-size: 22px; padding: 0; margin-top: 40px; margin-left: 70px;  font-weight: 400; font-family: Georgia, 'Times New Roman', Times, serif;">Vote your Answer</p>
                <form id="form" >
                    <div style="margin: 20px 25% 0px 28%;" class="row">
                        <div style="margin-right: 15%;" class="col">
                            <label  style="font-size: 23px; padding: 0; margin-right: 20px; font-weight: 400; font-family: Georgia, 'Times New Roman', Times, serif;" class="form-check-label" for="radioName1">
                                Yes
                              </label>
                            <input required style="width: 1.5em;  height: 1.5em;" class="form-check-input" type="radio" value="0" name="radioName" id="Select_0">
    
                        </div>
                        <div class="col">
                            <label  style="font-size: 23px; margin-right: 20px;  padding: 0; font-weight: 400; font-family: Georgia, 'Times New Roman', Times, serif;" class="form-check-label" for="radioName1">
                                No
                              </label>
                            <input required style="width: 1.5em;  height: 1.5em;"  class="form-check-input" type="radio" value="1" name="radioName" id="Select_1">
                        </div>
                        <small  style="margin-top: 20px; font-family: 'Raleway', sans-serif; "  id="voted_success"></small>
                      </div>    
                      <div  style="width: 20%; margin-bottom: 25px; margin-left: 37%; font-family: Georgia, 'Times New Roman', Times, serif;" class="col-md-6">
                        <label for="choice_per_vote" class="form-label">Choice Per Vote</label>
                        <input  required type="number" min="1" class="form-control" id="choice_per_vote">
                      </div>
                      <button id="send_choice" style="width: 160px; height: 50px; margin-left: 40%; font-weight: 500; background-color: #3ECF8E; margin-bottom: 12px; " type="submit" class="btn btn-primary">VOTE</button>
                </div>
                </form>
                <a id="voting_history" style="color: #202731; margin-right: 30px; font-weight: 400; font-family: Georgia, 'Times New Roman', Times, serif; display: none; " href="/voting_history"> <p>Check your Vote History</p> </a>
        </div>


    </section>

</body>
</html>
<script src="/js/index.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>
<script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
<script src="/socket.io/socket.io.js"></script>
<script src="/js/myalgo.min.js"></script>
<script src="/js/index.js"></script>
<script>
  console.log(MyAlgoConnect)
    const socket = io();
    const voted_out=$('#voted_success')
    const algo_balance=document.getElementById("algo_balance")
    const choice_balance=document.getElementById("choice_balance")
    const total_choice_transferred=document.getElementById("total_choice_sent")

    //Socket events and their respective functions to run

    
    socket.on("connect",(io)=>{
                console.log("the socket is connected")
              
            })

      //when balance is received from backend add it to text
    socket.on("balance",(data)=>{
                    console.log(data)
                    algo_balance.innerText=data
                })
    socket.on('choice_balance',(data)=>{
      console.log(data)
      choice_balance.innerText=data

    })

    socket.on("transferred_choice",(data)=>{
      console.log(data)
      total_choice_transferred.innerHTML=`You have sent ${data.total_transferred_choice}  choice coins over the last ${data.no_of_transactions} voting transactions`//changing the conteent of the div on this event
      total_choice_transferred.style.display="block"//making this div visible
      setTimeout(function(){
    total_choice_transferred.style.display="none";
},5000);//setting the display back to none after 5 seconds while not interrupting other code

  
})

    //transaction is completed with algosigner
    socket.on("txn",async(data)=>{
              const myAlgoWallet = new MyAlgoConnect();
                let txn=data.txn
                AlgoSigner=window.AlgoSigner
                let binarytx=new Uint8Array(txn);
                console.log(binarytx)
                const mode_connect=wallet_select.value.split("-")[1]
                //check the mode of connection if it was via signer and wallet before proceeding to sign transaction
                if(mode_connect=='signer'){
                  let base64tx=AlgoSigner.encoding.msgpackToBase64(binarytx);
                console.log(base64tx)
                let signedtxn=await AlgoSigner.signTxn([{txn: base64tx}])
                await AlgoSigner.send({
                    ledger: 'TestNet',
                    tx: signedtxn[0].blob,
                  });
                socket.emit("await_confirmation",{'txId':data.txId,'voted_for':data.voted_for})
                }else if(mode_connect=='mywallet'){
                  const signedTxn = await myAlgoWallet.signTransaction(binarytx); 
                  socket.emit("send_raw-await_confirmation",{signedTxn:signedTxn,'txId':data.txId,'voted_for':data.voted_for})
                }
            })

            socket.on("voted",(data)=>{
        voted_out.html(data)
    })

</script>

<script>
  // Get the modal
  var modal = document.getElementById("myModal");
  
  // Get the button that opens the modal
  var btn = document.getElementById("myBtn");
  
  // Get the <span> element that closes the modal
  var span = document.getElementsByClassName("close")[0];
  
  // When the user clicks the button, open the modal 
  btn.onclick = function() {
    modal.style.display = "block";
  }
  
  // When the user clicks on <span> (x), close the modal
  span.onclick = function() {
    modal.style.display = "none";
  }
  
  // When the user clicks anywhere outside of the modal, close it
  window.onclick = function(event) {
    if (event.target == modal) {
      modal.style.display = "none";
    }
  }
  </script>