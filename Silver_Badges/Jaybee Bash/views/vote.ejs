<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Voting Using Choice</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Raleway:wght@200;500&family=Roboto:ital,wght@1,300&family=Rubik:ital,wght@0,300;1,300;1,500&display=swap" rel="stylesheet">
    <body style="background-image: linear-gradient(white,#5F6ADA); overflow-y: scroll; ">
    <section style="height: max-content;">
      <nav style="position: absolute; top: 0px; width: 100%; background-color: #533AFE;" class="nav">
        <a style="color: white; font-size: 20px; margin-left: 250px; font-weight: 500; font-family: 'Raleway', sans-serif; " class="nav-link" aria-current="page" href="#"> <img style="height: 30px; align-self: center;" src="/img/choice2.png"alt=""> Choice</a>
        <a style="color: white; margin-left: 50%; font-family: 'Raleway', sans-serif; " class="nav-link" href="/">Home</a>
        <a style="color: white; font-family: 'Raleway', sans-serif;" class="nav-link " href="#">About</a>
      </nav>

        <div style="width: 90%; margin-top: 90px; margin-bottom: 70px;  padding-right: 0;background-repeat: no-repeat;  ;" class="container">
            <div class="election">
                <h3 style="font-family: 'Rubik', sans-serif; margin-left: 10%; display: inline-block;">VOTING USING CHOICE COIN</h3>
                <button id="connect_algosigner"   style=" font-family: 'Raleway', sans-serif; float: right; color: white; font-weight: 500; margin-right: 80px; background-color: #533AFE;" class="nav-link btn btn-primary">Connect Via Algosigner</button>
                
                <div style="font-family: 'Rubik',sans-serif; width: 630px; margin-left: 10%; margin-top: 55px; margin-bottom: 50px;">
                  <label style="margin-bottom: 15px; font-weight: 600;" for="inputState" class="form-label"> Wallet Address:</label>
                  <select  name="voted_for" required id="inputState" class="form-select">
                  </select>
                  <small>Algo Balance: <span id="algo_balance"></span>    Choice Balance: <span id="choice_balance"></span></small>
                </div>
                
                <div class="issue">
                  <h3 style="font-family: 'Rubik', sans-serif; font-weight: 600; letter-spacing: 1.2px  ; margin-left: 10%; display: inline-block;">ISSUE 001(Flat Earth Theory)</h3>
                  <p style="font-size: 18px; padding: 0; margin-top: 10px;  margin-left: 70px; letter-spacing: 1.75px;  font-weight: 400; font-family: Georgia, 'Times New Roman', Times, serif;">The flat Earth model is an archaic and scientifically disproven conception of Earth's shape as a plane or disk. Many ancient cultures subscribed to a flat Earth cosmography, including Greece until the classical period (323 BC), the Bronze Age and Iron Age civilizations.</p>
                  <p style="font-size: 18px; padding: 0; margin-top: -6.5px;   margin-left: 70px; letter-spacing: 1.75px;  font-weight: 400; font-family: Georgia, 'Times New Roman', Times, serif;">Despite several discoveries disproving flat earth theories, several people do not seem to believe it.Do you think the earth is flat?</p>
                </div>
                <p style="font-size: 22px; padding: 0; margin-top: 40px; margin-left: 70px;  font-weight: 400; font-family: Georgia, 'Times New Roman', Times, serif;">Vote your Answer</p>
                <form id="form" >
                    <div style="margin: 20px 25% 0px 28%;" class="row">
                        <div style="margin-right: 15%;" class="col">
                            <label  style="font-size: 23px; padding: 0; margin-right: 20px; font-weight: 400; font-family: Georgia, 'Times New Roman', Times, serif;" class="form-check-label" for="radioName1">
                                Yes
                              </label>
                            <input required style="width: 1.5em;  height: 1.5em;" class="form-check-input" type="radio" value="0" name="radioName" id="Select_0">
    
                        </div>
                        <div class="col">
                            <label  style="font-size: 23px; margin-right: 20px;  padding: 0; font-weight: 400; font-family: Georgia, 'Times New Roman', Times, serif;" class="form-check-label" for="radioName1">
                                No
                              </label>
                            <input required style="width: 1.5em;  height: 1.5em;"  class="form-check-input" type="radio" value="1" name="radioName" id="Select_1">
                        </div>
                        <small  style="margin-top: 20px; font-family: 'Raleway', sans-serif; "  id="voted_success"></small>
                      </div>    
                      <div  style="width: 20%; margin-bottom: 25px; margin-left: 37%; font-family: Georgia, 'Times New Roman', Times, serif;" class="col-md-6">
                        <label for="choice_per_vote" class="form-label">Choice Per Vote</label>
                        <input  required type="number" min="1" class="form-control" id="choice_per_vote">
                      </div>
                      <button id="send_choice" style="width: 160px; height: 50px; margin-left: 40%; font-weight: 500; background-color: #3ECF8E; margin-bottom: 12px; " type="submit" class="btn btn-primary">VOTE</button>
                </div>
                </form>
        </div>


    </section>

</body>
</html>
<script src="/js/index.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>
<script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
<script src="/socket.io/socket.io.js"></script>
<script src="/js/index.js"></script>
<script>
    const socket = io();
    const voted_out=$('#voted_success')
    const algo_balance=document.getElementById("algo_balance")
    const choice_balance=document.getElementById("choice_balance")

    //Socket events and their respective functions to run

    
    socket.on("connect",(io)=>{
                console.log("the socket is connected")
              
            })

      //when balance is received from backend add it to text
    socket.on("balance",(data)=>{
                    console.log(data)
                    algo_balance.innerText=data
                })
    socket.on('choice_balance',(data)=>{
      console.log(data)
      choice_balance.innerText=data

    })

    //transaction is completed with algosigner
    socket.on("txn",async(data)=>{

              console.log(data)
                let txn=data.txn
                AlgoSigner=window.AlgoSigner
                console.log(AlgoSigner)
                let binarytx=new Uint8Array(txn);//create new byte object from received buffer
                console.log(binarytx)
                let base64tx=AlgoSigner.encoding.msgpackToBase64(binarytx);
                console.log(base64tx)
                let signedtxn=await AlgoSigner.signTxn([{txn: base64tx}])
              
                console.log(signedtxn)
                await AlgoSigner.send({
                    ledger: 'TestNet',
                    tx: signedtxn[0].blob,
                  });
                socket.emit("await_confirmation",{'txId':data.txId,'voted_for':data.voted_for})
            })

            socket.on("voted",(data)=>{
        voted_out.html(data)
    })

</script>

